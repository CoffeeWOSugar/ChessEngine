<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Chess Engine – Game</title>
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body class="game-body">
    <header class="app-header">
      <h1 class="app-header__title">Play Chess</h1>
      <button class="header-btn" onclick="goHome()">← Back</button>
    </header>

    <main class="app-main">
      <div class="game-controls">
        <button class="btn btn-primary" onclick="newGame()">New Game</button>
        <label>
          Your move:
          <input
            type="text"
            id="moveInput"
            placeholder="e2e4, e7e8q..."
            autocomplete="off"
          />
        </label>
        <button class="btn btn-secondary" onclick="sendMove()">Submit</button>
      </div>

      <div id="status" class="game-status">No game started yet.</div>
      <div id="output" class="output-box game-output"></div>
    </main>

    <script>
      function goHome() { window.location.href = "/"; }

      function updateOutput(text) {
        const out = document.getElementById("output");
        out.textContent = text || "";
        out.scrollTop = out.scrollHeight;
      }

      function focusMoveInput() {
        let el = document.getElementById("moveInput");
        el.focus(); el.select();
      }

      async function newGame() {
        let s = document.getElementById("status");
        s.textContent = "Starting...";
        updateOutput("");
        try {
          let res = await fetch("/api/new-game", { method: "POST" });
          let data = await res.json();
          updateOutput(data.output || "");
          s.textContent = "Game started. You are White.";
        } catch (e) {
          s.textContent = "Error: " + e.message;
        }
        focusMoveInput();
      }

      async function sendMove() {
        let move = moveInput.value.trim();
        let s = document.getElementById("status");
        if (!move) return;

        try {
          let res = await fetch("/api/move", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ move }),
          });

          let data = await res.json();
          updateOutput(data.output || "");
          s.textContent = "Move applied.";
          moveInput.value = "";
        } catch (e) {
          s.textContent = "Error: " + e.message;
        }

        focusMoveInput();
      }

      document.addEventListener("DOMContentLoaded", () => {
        moveInput.addEventListener("keydown", (e) => {
          if (e.key === "Enter") sendMove();
        });
        focusMoveInput();
      });
    </script>
  </body>
</html>
