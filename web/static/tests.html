<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Chess Engine – Tests</title>
    <style>
      body {
        font-family: system-ui, sans-serif;
        background: #020617;
        color: #e5e7eb;
        margin: 0;
      }
      header {
        padding: 1rem 2rem;
        background: #0f172a;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      header h1 {
        margin: 0;
        font-size: 1.3rem;
      }
      header button {
        cursor: pointer;
        border: none;
        border-radius: 999px;
        padding: 0.4rem 1rem;
        background: #1e293b;
        color: #e5e7eb;
        font-size: 0.9rem;
      }
      header button:hover {
        background: #111827;
      }
      main {
        padding: 1.5rem 2rem;
        max-width: 900px;
        margin: 0 auto;
      }
      #runBtn {
        cursor: pointer;
        border: none;
        border-radius: 999px;
        padding: 0.6rem 1.4rem;
        font-size: 1rem;
        background: #22c55e;
        color: #022c22;
        box-shadow: 0 10px 20px rgba(34,197,94,0.4);
      }
      #runBtn:hover {
        background: #16a34a;
      }
      #status {
        margin-top: 1rem;
        font-weight: 500;
      }
      #output {
        margin-top: 1rem;
        padding: 0.75rem;
        border-radius: 0.5rem;
        background: #020617;
        border: 1px solid #1f2937;
        white-space: pre-wrap;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        max-height: 400px;
        overflow-y: auto;
      }
      .ok {
        color: #4ade80;
      }
      .fail {
        color: #f97373;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Engine Tests</h1>
      <button onclick="goHome()">← Back to menu</button>
    </header>
    <main>
      <p>Click the button below to run the engine's built-in Perft tests.</p>
      <button id="runBtn">Run tests</button>
      <div id="status"></div>
      <div id="output"></div>
    </main>

    <script>
      function goHome() {
        window.location.href = "/";
      }

      async function runTests() {
        const statusEl = document.getElementById("status");
        const outputEl = document.getElementById("output");
        statusEl.textContent = "Running tests...";
        statusEl.className = "";
        outputEl.textContent = "";

        try {
          const res = await fetch("/api/run-tests", { method: "POST" });
          if (!res.ok) {
            const err = await res.json().catch(() => ({}));
            throw new Error(err.detail || "HTTP " + res.status);
          }
          const data = await res.json();
          outputEl.textContent = data.output || "";

          if (data.success) {
            statusEl.textContent = "Tests passed (return code " + data.returncode + ")";
            statusEl.className = "ok";
          } else {
            statusEl.textContent = "Tests failed (return code " + data.returncode + ")";
            statusEl.className = "fail";
          }
        } catch (e) {
          statusEl.textContent = "Error while running tests: " + e.message;
          statusEl.className = "fail";
        }
      }

      document.getElementById("runBtn").addEventListener("click", runTests);
    </script>
  </body>
</html>

